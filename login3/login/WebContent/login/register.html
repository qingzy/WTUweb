<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>注册页面</title>
  <link href="css/register.css" rel="stylesheet">
  	<script src="js/jquery-3.1.1.min.js"></script>
</head>
<body>

 <div id="loginForm">
		 <p>
			<span id="zhuce">注册账号</span>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span><a href="login.jsp">已有账号，去登录</a></span>
		 </p>
 	
        <form action="../AddServlet.do" method="post" id="form01">
        <input name="id" value="2" type="hidden"/>
            <p><input id="userName" name="userName" type="text" placeholder="用户名"/>
            </p>
            <p>
             <span id="userNamemessage"></span>
            </p>
           
            <p><input id="Name" name="Name" type="text" placeholder="真实姓名"/>
            </p>
 			<p>
             <span id="Namemessage"></span>
            </p>
                
            <p><input id="email" name="email" type="text" placeholder="邮箱"/>
            </p>
			<p>
             <span id="emailmessage"></span>
            </p>
             
            <p>
            	<select id="shengfen" name="shengfen" οnchange="test1();">
            		<option value=" " id="shengfen1" >请选择省份</option>
            	</select>
             </p>			
            <p>
             	<span id="shengfenmessage"></span>
            </p>
           
            <p>
            	<select id="city" name="city" >
            		<option value=" " id="city1" >请选择城市</option>
            	</select>
             </p>
			<p>
             	<span id="citymessage"></span>
            </p>
            <p><input id="password" name="password" type="password" placeholder="密码"/>   	
            </p>
            <p>
               <span id="passwordmessage"></span>
            </p>
            
            <p><input id="password2" name="password2" type="password" placeholder="确认密码"/> 	
            </p>
            <p>
            	<span id="password2message"></span>
            </p>
            
            <p>
                <input id="btLogin" type="button" value="注册" onClick="check()"></p>
        </form>
    </div>
</body>
<script >
	var flag1=/^[a-zA-Z]+[0-9a-zA-Z]{3,14}$/ //表示只能使用英文字母和数字，以字母开头，长度为4到15个字符
    var flag2=/^[\u4e00-\u9fa5]{2,4}$/;//真实姓名只能是2-4长度的中文
    var flag3=/^([a-zA-Z0-9_.-]+)@([da-z.-]+).([a-z.]{2,6})$/; //邮箱地址是否合法
    var flag4=/^.{4,}$/; //密码长度至少为4
    
    var sheng =$("#shengfen");
    var shi =$("#city");
  
	var f1,f2,f3,f4,f5,f6,f7;
    var shengJson =[];
    var shiJson =[];
    fn();  //加载页面的时候就直接加载这个初始化省份的信息


		//省份及城市信息的显示
		//1、加载数据
		function fn(){
		    $.ajax({
		        "url" : "city.json",
		        "dataType" : "json",
		        "type" : "GET",
		        "success" :function(data){
		            //把返回的数据加载到省份对应的下拉框中
		            shengJson = data.city;
		            var op01="";
		
		            //遍历shengJson里的name属性写入到option标签里
		            $(shengJson).each(function(){
		                //在页面中创建标签
		                op01 +="<option id='shengfen1' value='"+this.name+"'>"+this.name+"</option>"
		            });
		            //把创建的option标签添加到select标签里去
		            sheng.append(op01);
		        }
		    });
		}
		
		//2.选择一个省份后，在第二个下拉框中加载对应这个省份所有的市区信息
		sheng.change(function(){
		    //加载数据前把之前的数据清空
		    shi.children().not(":first").remove();
		    
		
		    //遍历所有的省份信息，判断用户选择的身份信息和后台的储存位置是否对应
		    for(var i =0; i<shengJson.length ; i++){
		        if(this.value == shengJson[i].name){
		            //加载这个省份所对应的所有市区信息
		            shiJson = shengJson[i].city;
		            var op02="";
		
		            $(shiJson).each(function(){
		                op02 +="<option id='city' value='"+this.name+"'>"+this.name+"</option>"
		            });
		            //把创建的option标签添加到select标签里去
		            shi.append(op02);
		
		        }
		    }
		});
		
       //正则判断
        $(function () {
    		//1.获取input标签,为input标签绑定一个失去焦点事件
            $("input[name='userName']").blur(function () {
            
                //2.获取文本框中的值
                var userNameVal = $(this).val();

                //3.校验名称不能为空
                if(userNameVal=='') {
                    $("#userNamemessage").html("<font color='red'>*用户名不能为空</font>");
                }else if(!flag1.test(userNameVal)){
                    $("#userNamemessage").html("<font color='red'>*只能使用英文字母和数字，以字母开头，长度为4到15个字符</font>");
                }else{
                	$("#userNamemessage").html(""); 
                	f1=true;
      
                }
               
            });

            $("input[name='Name']").blur(function () {
                
                //2.获取文本框中的值
                var Name = $(this).val();

                //3.校验名称不能为空
                if(Name=='') {
                    $("#Namemessage").html("<font color='red'>*真实姓名不能为空</font>");
                    
                }else if(!flag2.test(Name)){
                    $("#Namemessage").html("<font color='red'>*真实姓名只能是2-4长度的中文</font>");
                }else{
                	$("#Namemessage").html("");  
                	f2=true;
                }
               
            });
            
            
            
            $("input[name='email']").blur(function () {
                
                //2.获取文本框中的值
                var email = $(this).val();

                //3.校验名称不能为空
                if(email=='') {
                    $("#emailmessage").html("<font color='red'>*邮箱不能为空</font>");
                }else if(!flag3.test(email)){
                    $("#emailmessage").html("<font color='red'>*邮箱地址不合法！</font>");
                }else{
                	$("#emailmessage").html("");
                	f3=true;
                }
               
            });
            
			$("#shengfen1").blur(function () {
				alert(111111111111);          
                //2.获取文本框中的值
                var shengfen = $(this).val();

                //3.校验名称不能为空
                if(shengfen=='') {
                    $("#shengfenmessage").html("<font color='red'>*省份不能为空</font>");
                }else{
                	$("#shengfenmessage").html("");
                	f4=true;
                }
               
            });
          
		
			
			
            
			$("input[name='password']").blur(function () {
                
                //2.获取文本框中的值
                var password = $(this).val();

                //3.校验名称不能为空
                if(password=='') {
                    $("#passwordmessage").html("<font color='red'>*密码不能为空</font>");
                }else if(!flag4.test(password)){
                    $("#passwordmessage").html("<font color='red'>*密码长度至少为4</font>");
                }else{
                	$("#passwordmessage").html("");  
                	f6=true;
                }
               
            });
			
			$("input[name='password2']").blur(function () {
				 var password = $("input[name='password']").val();
                //2.获取文本框中的值
                var password2 = $(this).val();

                //3.校验名称不能为空
                if(password2!=password) {
                	$("#password2message").html("<font color='red'>*两次密码不一致</font>");  
                }else{
                	$("#password2message").html("");  
                	f7=true;
                }
               
            });
            
			
			 /* 进不去change方法  只能用提交时点击事件验证
			 	$("input[name='shengfen']").change(function () {
				 var shengfen = $(this).val();
				alert("sssssssffffffff"+shengfen);
	            //3.校验名称不能为空
	            if(shengfen==' ') {
	                $("#shengfenmessage").html("<font color='red'>*城市不能为空</font>");
	            }else{
	            	$("#shengfenmessage").html("");
	            	f5=true;
	            } 
              
           });  */

        })
       
       
       
        function check(){
			var form01 = document.getElementById("form01");
			var shengfen1 = document.getElementById("shengfen").value;
			var city1 = document.getElementById("city").value;
			if(shengfen1==" "){
				$("#shengfenmessage").html("<font color='red'>*省份不能为空</font>");
			}
			if(city1==" "){
				$("#citymessage").html("<font color='red'>*城市不能为空</font>");
			}
			//验证提交
			if(f1&&f2&&f3&&f6&&f7){
				//alert("模拟提交");
				form01.submit();	
			}else{
				alert("尚未填写完毕，请继续填写！");
			}
		
		}
            
    </script>
</html>